% Package   : xleading -- Set the leading
% Copyright : 2025 (c) Oliver Beery <beeryoliver@gmail.com>
% CTAN      : <ADD CTAN LINK HERE>
% Repository: https://github.com/beeryoliver/xleading
% License   : The LaTeX Project Public License 1.3c

% LaTeX2e version 2023-11-01 added \IfExplAtLeastTF.
\NeedsTeXFormat{LaTeX2e}[2023-11-01]
\ProvidesExplPackage{xleading}{2025-09-22}{0.0.0}{Set the leading}

\msg_new:nnn { xleading } { l3kernel }
  {
    The~ xleading~ package~ could~ not~ load. \\
    This~ package~ requires~
    L3~ programming~ layer~ version~ 2023-11-01~ or~ newer.
  }
\msg_new:nnn { xleading } { leading }
  { The~ xleading~ package~ is~ incompatible~ with~ the~ leading~ package. }

\IfExplAtLeastTF { 2023-11-01 } { }
  { \msg_critical:nn { xleading } { l3kernel } }
\hook_gput_code:nnn { package / leading / before } { xleading }
  { \msg_error:nn { xleading } { leading } }

% MESSAGE

\msg_new:nnn { xleading } { math-mode-invalid }
  { '\iow_char:N \\#1'~ invalid~ in~ math~ mode~ \msg_line_context:. }

% DOCUMENT COMMAND

\NewDocumentCommand \leading { m }
  {
    \mode_if_math:TF
      { \msg_error:nnn { xleading } { math-mode-invalid } { leading } }
      { \__xleading_set_leading:n {#1} }
  }
\cs_new_protected:Npn \__xleading_set_leading:n #1
  {
    \linespread
      { \fp_eval:n { \dim_to_fp:n {#1} / \dim_to_fp:n { \f@baselineskip } } }
    \selectfont
  }

% TEXT PURIFY

\text_declare_purify_equivalent:Nn \leading { \use_none:n }